<!DOCTYPE html>
<html lang="en" data-critters-container>
  <head>
    <meta content="text/html; charset=windows-1251" http-equiv="content-type">
    <meta charset="utf-8s">
    <title>OPTIMUS Results Page</title>
    <base href="https://raw.githubusercontent.com/zeroturtle/zeroturtle.github.io/main/">
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="icon" type="image/x-icon" href="favicon.png">
<style>
::backdrop {
  background: rgba(0,0,0,0.7);
  opacity: 0.75;
}

</style>

  </head>
  <body id="Body">
   <h3> Resulting Table: </h3>

<dialog>
  <div onclick="closedialog();" style="cursor: pointer;">X</div>
  <div id="popup-content">
    <iframe src="about:blank" onload="r();" style="max-width:400px;min-width:100px;min-height:100px;border:none;" sandbox></iframe>
  </div>
</dialog>

   <hr>
   <div id="container"></div>
    <script>
	// чтоб закрыть dialog
	const modal = document.querySelector('dialog')
	const frame = modal.querySelector('iframe')
	const baseURL = document.getElementsByTagName('base')[0].href
	function closedialog() {
		frame.srcdoc = '';
		modal.close()
	}
	function windowOnClick(event) {
		if (event.target === modal) {
			closedialog()
		}
	}
	window.addEventListener("click", windowOnClick); 

	// загружаем протокол
	window.addEventListener("load", (event) => {
		fetch('proto.html', document.baseURL)
		.then(response => response.text())
		.then((data) => {
			container.innerHTML= data   //выводим протокол
			// для каждой ссылке не "0" добавляем вызов detail
			for (lnk of [].filter.call(document.getElementsByTagName('a'), item =>(item.pathname.split('/').slice(-1))[0] !=0))  
				if (lnk.href.endsWith('jpg')) {
					lnk.addEventListener("click", displayTeamDetails)
				}
				else { 
					lnk.addEventListener("click", displayRoundDetails)
				}
			// заменим названия стран на флаги
/*			for(t of document.querySelectorAll('td')) 
				if (t.ParentElement.colIndex == 2) {
					td.innerHTML = `<img src="./flags/${td.innerText.lowerCase()}.svg" alt="${td.innerText}" width="4em" height="3em" />`
				}
*/
/* intime 
//css
.flag-250, .flag-fifa-fra, .flag-fr, .flag-fra, .flag-ioc-fra {
  background-image: url(./flags/fra.svg);
}
//html
//<span class="flag flag-1x flag-ioc-fra" data-toggle="popover" data-content="FRA" data-original-title="" title="">&nbsp;</span>
*/
		})
	})
// установить размер dialog по содержимому
function r() {
	frame.style.height=`${frame.contentDocument.body.scrollHeight+45}px`
	frame.style.width=`${frame.contentDocument.body.scrollWidth}px`
}
// показать команду
function displayTeamDetails() {
	event.preventDefault()
//	frame.src = new URL('Photo/'+(this.pathname.split('/').slice(-1))[0], baseURL)
//	modal.showModal()
	window.open(new URL('Photo/'+(this.pathname.split('/').slice(-1))[0], baseURL), "_blank")//"Team Photo", "width=500,height=400")
}
// показать detail
function displayRoundDetails() {
	event.preventDefault()
	// загружаем судейскую записку
	let url = new URL(this+'.html', baseURL)
	fetch(url)
		.then(response => response.text())
		.then((data) => {
			frame.srcdoc = data
//			frame.contentDocument.open()
//			frame.contentDocument.write(data)
//			frame.contentDocument.close()
//			for (l of frame.contentDocument.querySelectorAll('a')) l.setAttribute('target','_blank')
			modal.showModal()
		})
		.catch(error => console.error('Error fetching file:', error))
}


    </script>

  </body>
</html>