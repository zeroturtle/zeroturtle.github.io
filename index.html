<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <title>OPTIMUS Results Site</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  /* свечение для .btn-dark */
  .btn-outline-dark.glow {
    box-shadow:
      0 0 10px rgba(138,43,226,0.8),
      0 0 20px rgba(0, 180, 255, 0.6);
    animation: glow-pulse 3s ease-in-out infinite;
  }
  /* и дышащая подсветка */
  @keyframes glow-pulse {
    0%, 100% {
      box-shadow:
        0 0 8px rgba(138,43,226,0.6),
        0 0 16px rgba(0,180,255,0.4);
    }
    50% {
      box-shadow:
        0 0 18px rgba(138,43,226,1),
        0 0 36px rgba(0,180,255,0.9);
    }
  }
  @media (prefers-reduced-motion: reduce) {
    .btn-dark.glow {
      animation: none;
    }
  }

/* 1. Определяем ключевые кадры для анимации вращения */
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
/* 2. Применяем анимацию к изображению */
.rotating-image {
  animation-name: spin; /* Имя анимации */
  animation-duration: 30s; /* Время одного оборота */
  animation-timing-function: linear; /* Линейная скорость */
  animation-iteration-count: infinite; /* Бесконечное повторение */
}
</style>

<script>
/*here helpful func to work with cookie*/
function getCookie(name, json=false) {
  if (!name) {
    return undefined;
  }
  /*
  Returns cookie with specified name (str) if exists, else - undefined
  if returning value is JSON and json parameter is true, returns json, otherwise str
  */
  let matches = document.cookie.match(new RegExp(
    "(?:^|; )" + name.replace(/([.$?*|{}()\[\]\\\/+^])/g, '\\$1') + "=([^;]*)"
  ));
  if (matches) {
    let res = decodeURIComponent(matches[1]);
    if (json) {
      try {
        return JSON.parse(res);
      }
      catch(e) {}
    }
    return res;
  }
  return undefined;
}
function setCookie(name, value, options = {path: '/', SameSite: 'strict'}) {
  /*
  Sets a cookie with specified name (str), value (str) & options (dict)

  options keys:
    - path (str) - URL, for which this cookie is available (must be absolute!)
    - domain (str) - domain, for which this cookie is available
    - expires (Date object) - expiration date&time of cookie
    - max-age (int) - cookie lifetime in seconds (alternative for expires option)
    - secure (bool) - if true, cookie will be available only for HTTPS.
                      IT CAN'T BE FALSE
    - samesite (str) - XSRF protection setting.
                       Can be strict or lax
                       Read https://web.dev/samesite-cookies-explained/ for details
    - httpOnly (bool) - if true, cookie won't be available for using in JavaScript
                        IT CAN'T BE FALSE
  */
  if (!name) {
    return;
  }

  options = options || {};

  if (options.expires instanceof Date) {
    options.expires = options.expires.toUTCString();
  }

  if (value instanceof Object) {
    value = JSON.stringify(value);
  }
  let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
  for (let optionKey in options) {
    updatedCookie += "; " + optionKey;
    let optionValue = options[optionKey];
    if (optionValue !== true) {
      updatedCookie += "=" + optionValue;
    }
  }
  document.cookie = updatedCookie;
}
function deleteCookie(name) {
  /*
  Deletes a cookie with specified name.
  Returns true when cookie was successfully deleted, otherwise false
  */
  setCookie(name, null, {
    expires: new Date(),
    path: '/',
    SameSite: 'strict'
  })
}
</script>

<script>
  var page = 0  //pagination endless/infinity list
  var isLoading = false
  var eventsDir = './events/'

  /* endless list thanks to 
	https://www.toolify.ai/gpts/how-to-implement-infinite-scroll-pagination-with-php-mysql-jquery-366007
	https://sky.pro/media/kak-sozdat-sajt-s-dinamicheskoj-zagruzkoj-kontenta-pri-prokrutke/#title2
  */	
  function loadDataContent() {
    if (isLoading) { return; }
    isLoading = true;
    // получаем из сервера json со списком event
//    fetch('http://localhost/index.php?page='+page) //здесь вызвать index.php, возвращает json массив event.
    fetch('https://zeroturtle.github.io/events.json') // получаем массив event из json-файла.
      .then(response => response.json())
      .then(json => {
         const template = document.getElementById('event_template');
         const rank_tmpl = document.getElementById("rank_template")
         for (item in json) {
           var event = json[item]
           event.id = item.slice(1)
           event.datefrom = new Date(event.date_start).toDateString()    // преобразуем поле даты в строку
           event.dateto = new Date(event.date_end).toDateString()
           const clone = template.content.cloneNode(true);
           clone.getElementById('event_location').textContent = event.location
           clone.getElementById('event_date').textContent = `${event.datefrom} - ${event.dateto}`
           clone.getElementById('event_name').textContent = event.name
           clone.getElementById('event_link').href = `${eventsDir}${event.id}/`
           clone.getElementById('event_logo1').src = `${eventsDir}${event.id}/Logo1.jpg`
           clone.getElementById('event_logo2').src = `${eventsDir}${event.id}/Logo2.jpg`
           event.events.forEach( (rank, index) => {
             const rank_clone = rank_tmpl.content.cloneNode(true);
             rank_clone.getElementById('rank_link').href = `${eventsDir}${event.id}/?r=${rank.event_id}`
             rank_clone.getElementById('rank_link').textContent = rank.name
             clone.getElementById('event_ranks').appendChild(rank_clone);
           })
           EventsList.appendChild(clone);
         }

        isLoading = false; //для постраничного вывода
        page++
      })
      .catch(error => console.log('Ошибка чтения json:', error)); 
  }

  function isset(variable) {
    return typeof variable !== typeof undefined ? true : false;
  }
  window.addEventListener('load', ()=>{
    ["Year","Type","Name"].forEach((elem)=>{
      document.getElementById(elem).value = (isset(getCookie(elem))) ? getCookie(elem) : ''
    })
    updateNavbarSummary();
    // загружаем первую страницу
    loadDataContent()
    // фильтр по нажатию Enter
    document.getElementById('Name').addEventListener('keypress', function (e) {
      if (event.keyCode === 13 || event.code === "Enter") {
        searchButton.click()
      }
    })
  })
  //подгружаем следующую часть списка в конце страницы
  window.addEventListener('scroll', () => { 
    var scrollPosition = window.innerHeight + window.pageYOffset;
    var pageHeight = document.documentElement.scrollHeight;
    if ((scrollPosition >= pageHeight - 100) && !isLoading) {
      loadDataContent() 
    }
  }); 
      //обработчик ошибок для всех изображений
  function imageError(image) {
    image.onerror = null;
    image.src = "../../images/OPTIMUS3.svg";
  }
</script>
  </head>
  <body lang="en">

<div class="container">

     <!-- page header -->
    <header style="background-image: url(images/Title.jpg); background-size: 100% auto;">
        <div class="d-flex justify-content-between">
           <div class="flex-fill">
              <a href="#"><img src="images/turtleZ_color.png" alt="OPTIMUS LOGO" height="100px" class="rotating-image m-2"></a>
              <span class="fs-1"><strong>OPTIMUS</strong> <span class="text-danger">scoreboard</span><span> DEMO </span></span>
           </div>
           <div class="m-3 text-end">
		<a href="about.html" class="btn btn-outline-dark pull-right glow text-nowrap" role="button">About OPTIMUS</a>
           </div>
         </div>
    </header>


<nav id="navigation" class="navbar navbar-dark navbar-expand-lg bg-dark">
  <div class="container-fluid">
    <!-- здесь будут показываться выбранные значения -->
    <div class="d-lg-none ms-2 flex-fill text-secondary text-truncate text-nowrap text-center text-uppercase small" style="min-width:0" id="navbar-selected-info"></div>

    <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse w-100" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a title="reset filters" class="nav-link link-warning text-truncate" aria-current="page" id="ALL" href="#" onclick="clearCookie();">Choose the season and type of competition to display.</a>
        </li>
        <li class="nav-item m-1">
          <select class="form-select my-select" title="Choose a season" id="Year" onchange="getComboA(this);">
            <option value="">All seasons</option>
            <option value="2025">2025</option>
            <option value="2024">2024</option>
          </select>
        </li>
        <li class="nav-item m-1">
          <select class="form-select my-select" title="Select a disciplines" id="Type" onchange="getComboA(this);">
            <option value="">All disciplines</option>
            <option value="FS">Formation Skydiving</option>
            <!-- <option value="SF">Speed Formation Skydiving</option> -->
            <option value="AE">Artistic Events</option>
            <option value="CF">Canopy Formation</option>
            <option value="WS" disabled>Wingsuit Flying</option>
<!--
            <option value="SF" disabled>Indoor Solo Freestyle</option>
            <option value="DS" disabled>Indoor Solo Speed</option>
            <option value="DY" disabled>Dynamic Flying</option>
            <option value="SP" disabled>Speed Skydiving</option>
            <option value="CP" disabled>Canopy Piloting</option>
-->
          </select>
        </li>
      </ul>  
      <div role="search" class="d-flex">
          <input class="form-control me-2 d-flex" type="search" placeholder="Search" title="set part of string name or place" id="Name">
          <button class="btn btn-outline-success" type="submit" onclick="getComboA(Name);" id="searchButton">Search</button>
      </div>
    </div>
  </div>
</nav>


<!-- events list -->
<div class="container-fluid">
        <!-- template для построения списка event --> 
        <template  id="event_template">
          <tr class="">
            <td class="w-auto align-top"><img class="mx-2" id="event_logo1" src="" alt="Logo1" onerror="imageError(this)" style="max-height: 80px; max-width: 80px;"></td>
            <td class="w-auto align-top"><div class="d-none d-sm-block"><img class=" mx-2" id="event_logo2" src="" alt="Logo2" onerror="imageError(this)" style="max-height: 80px; max-width: 80px;"></div></td>
            <td class="w-75">
              <div class="">
                <div class="text-uppercase">
                  <a class="text-decoration-none" id="event_link" href="">
                  <span class="fw-bold" id="event_name"></span>
                  <br>
                  <span class="text-secondary" id="event_date"></span>
                  <br>
                  <span class="text-secondary" id="event_location"></span>
                  </a>
                </div>
                <div class="d-none d-lg-block" id="event_ranks">
                </div>
              </div>
            </td>
          </tr>
        </template>
        <template  id="rank_template">
                  <span class="border-start border-2 px-2" style="float:right;">
                     <a class="link-offset-2 link-underline link-underline-opacity-0 link-underline-opacity-75-hover" id="rank_link" href=""></a> 
                  </span>
        </template>

    <div class="table-responsive">
      <table class="table table-striped table-hover">
      <style scoped>
        table td:nth-child(-n+2) {
          width: 100px;
          white-space: nowrap;
          text-align: center;
        }
      </style>
        <tbody id="EventsList">
        </tbody>
      </table>
    </div>
</div>
<!-- events list -->


  <footer class="sticky-bottom py-3 my-4 border-top">
      <style scoped>
        footer {
          background: linear-gradient(to top, #2a2d32, #3e444c, #525963);
          color: #e5e7eb;            /* светло-серый текст */
          text-align: center;
          padding: 24px 12px;
          font-size: 14px;
          border-top: 1px solid #1f2937;
          box-shadow:
            0 -4px 14px rgba(0, 0, 0, 0.4),
            0 -1px 12px rgba(120, 160, 255, 0.1); /* лёгкое синеватое свечение */
          overflow: hidden;
        }
        footer a {
          color: #93c5fd;
          text-decoration: none;
        }
        footer a:hover {
          text-decoration: underline;
        }
      </style>
    <div class="d-flex justify-content-between align-items-center">
      <div class="mx-3"> <img src="images/turtleZ_color.png" style="height:2.2rem; float:left;"> &copy 2008-2025 &nbsp;  <span class="text-white fw-bold h4" nowrap>  Zeroturtle</span>   | <span class="text-nowrap"><small>Last update: <span id="lastUpdate"></span></small></span> </div>
      <div class="mx-3"> <a data-bs-toggle="modal" data-bs-target="#privatPolicy" href="#" class="link-light link-underline link-underline-opacity-0 link-underline-opacity-75-hover">Privacy policy</a> </div>
    </div>
    <script>
      // Последняя дата обновления страницы
      const lastMod = new Date(document.lastModified);
      const formatted = lastMod.toLocaleDateString("en-GB", {
        day: "2-digit",
        month: "short",
        year: "numeric"
      });
      document.getElementById("lastUpdate").textContent = formatted;
    </script>
  </footer>  


</div> <!--container-->


  <div class="modal fade" id="privatPolicy" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable modal-fullscreen-md-down">
      <div class="modal-content">
        <div class="modal-header bg-info">
          <h5 class="modal-title" id="myModalLabel">Privacy Policy</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">          
          <p> Insert the policy here. </p>
        </div>
      </div>
    </div>
  </div>
  <script>  
    // Получите ссылку на модальное окно
    var myModal = document.getElementById('privatPolicy');
    // Создайте обработчик события `show.bs.modal`
    myModal.addEventListener('show.bs.modal', function (event) {
      // Получите элемент, в который нужно вставить текст
      var modalBody = this.querySelector('.modal-body');
      // Задайте текст, который вы хотите загрузить
      //var textToLoad = 'Этот текст был загружен в модальное окно с помощью JavaScript!';
      // Вставьте текст в тело модального окна
      //modalBody.innerHTML = textToLoad;
      loadFile("https://zeroturtle.github.io/privacy_policy").then(fileContent => {
        if (fileContent) {
          modalBody.innerHTML = `<pre>${fileContent}</pre>`;
        }
      })
    });
   async function loadFile(filePath) {
       try {
         const response = await fetch(filePath);
         const fileContent = await response.text();
         return fileContent;
       } catch (error) {
         console.error("Ошибка загрузки файла:", error);
         return null;
       }
     }
  </script>

<script>
  function getComboA(selectObject) {
    var value = selectObject.value;
    if (value==0) deleteCookie(selectObject.id)
    else setCookie(selectObject.id, value)
    window.location.reload();
  }
  function clearCookie() {
    deleteCookie('Year');
    deleteCookie('Type');
    deleteCookie('Name');
    updateNavbarSummary();
    window.location.reload();
  }
</script>

  <script>
    function updateNavbarSummary() {
      const selects = document.querySelectorAll(".my-select");
      const info = document.getElementById("navbar-selected-info");

      info.textContent = [...selects]
        .filter(s => s.selectedIndex > 0)        // оставляем только те select, где выбран не первый элемент
        .map(s => s.options[s.selectedIndex].text)
        .join(" • ");
    }

    // при изменении select
    document.querySelectorAll(".my-select").forEach(s => {
      s.addEventListener("change", updateNavbarSummary);
    });

    // при загрузке
    updateNavbarSummary();
  </script>



  </body>
</html>